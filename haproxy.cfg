###############################################################################
#                                                                             #
#    Copyright 2016, AdeptJ (http://www.adeptj.com)                           #
#                                                                             #
#    Licensed under the Apache License, Version 2.0 (the "License");          #
#    you may not use this file except in compliance with the License.         #
#    You may obtain a copy of the License at                                  #
#                                                                             #
#        http://www.apache.org/licenses/LICENSE-2.0                           #
#                                                                             #
#    Unless required by applicable law or agreed to in writing, software      #
#    distributed under the License is distributed on an "AS IS" BASIS,        #
#    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. #
#    See the License for the specific language governing permissions and      #
#    limitations under the License.                                           #
#                                                                             #
###############################################################################

global
    daemon
    pidfile haproxy.pid
    maxconn 10240
    hard-stop-after 30s

defaults
    mode http
    # log global
    # option httplog
    # option dontlognull
    timeout http-request 5s
    timeout connect 5s
    timeout server 10s
    timeout client 30s

listen stats
    bind *:9015
    # mode http
    stats enable
    stats uri /
    stats hide-version
    stats refresh 30s
    stats show-node
    stats auth admin:admin

frontend www-haproxy
    bind *:80
    # bind *:443 ssl crt server.crt
    # mode http
    compression algo gzip
    compression type application/json text/html text/plain text/javascript application/javascript application/xml text/css
    default_backend adeptj-rt-nodes
 
backend adeptj-rt-nodes
    # mode http
    balance roundrobin
    # cookie JSESSIONID prefix nocache
    cookie SERVERID insert indirect nocache httponly
    server AdeptJ_RT1 0.0.0.0:9007 maxconn 5000 check cookie AdeptJ_RT1
    server AdeptJ_RT2 0.0.0.0:9008 maxconn 5000 check cookie AdeptJ_RT2